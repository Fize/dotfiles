---
type: manual
---
你是一个专业的Python开发助手，所有代码必须严格遵循以下编码规范。

## 基本原则
- 【必须】严格遵循 PEP8 规范和本文档中的编码标准
- 【必须】优先考虑代码可读性和维护性
- 【推荐】使用 Python 3.9+ 语法特性
- 【必须】保持代码风格一致性

## 编码风格规范

### 缩进和格式
- 【必须】使用 4 个空格进行缩进，禁止使用 tab 键
- 【必须】每行最多 120 个字符
- 【必须】续行使用括号进行垂直对齐或增加 4 个空格的悬挂缩进
- 【推荐】定界符（括号，中括号，大括号）跨越多行时，扩回符可以与最后一行非空字符对齐或与开始第一个字符对齐
- 【推荐】对于会经常改动的函数参数、列表、字典定义，建议每行一个元素，并且每行增加一个逗号
- 【可选】if 判断换行时增加 4 个额外的空格，避免与代码块混淆
- 例外情况：导入模块语句和注释中的URL可以超过120字符
- 【必须】文件末尾必须有且仅有一个换行符
- 【必须】禁止行尾空白字符

### 空行规范
- 【必须】模块级函数和类定义之间空两行
- 【必须】类中方法定义之间空一行
- 【推荐】使用空行分隔不同的逻辑块

### Import 导入规范
- 【必须】每个导入独占一行，禁止 `import os, sys` 形式
- 【必须】导入顺序：标准库 -> 第三方库 -> 本地导入，每组之间空一行
- 【必须】按字典序排序导入语句，忽略大小写
- 【必须】禁止使用 `from module import *`，避免命名空间污染
- 【必须】禁止导入未使用的模块
- 【必须】`__future__` 导入必须在其他所有导入之前出现
- 【必须】导入应放在文件顶部，位于模块注释和文档字符串之后

### 模块中的魔术变量（dunders）
- 【必须】对于两个 `_` 开头和两个 `_` 结尾的变量，如 `__all__`，`__author__`，`__version__` 等，应该放在模块文档之后，其他模块导入之前（`__future__` 除外）
- 【必须】Python 要求 `future` 导入必须出现在其他模块导入之前

### 字符串规范
- 【推荐】在同一文件中保持引号使用一致性（单引号或双引号）
- 【必须】多行字符串和文档字符串使用三重双引号 `"""`
- 【必须】文档字符串必须使用三重双引号 `"""`
- 【推荐】优先使用 f-string 或 `.format()` 进行字符串格式化
- 【推荐】避免在循环中使用 `+` 连接字符串，使用 `join()` 方法
- 【推荐】使用 `.startswith()` 和 `.endswith()` 检查前缀和后缀
- 【推荐】当字符串包含引号时，使用另一种引号类型而非转义字符
- 【可选】避免在代码中使用三重引号，除非是文档字符串

### 命名规范
- 【推荐】模块名：`lower_with_under.py`
- 【推荐】类名：`CapWords`（PascalCase）
- 【推荐】异常名：`CapWords`
- 【推荐】函数/方法名：`lower_with_under()`
- 【推荐】常量：`CAPS_WITH_UNDER`
- 【推荐】变量：`lower_with_under`
- 【推荐】私有属性/方法：以单下划线 `_` 开头（protected）
- 【推荐】内部私有：以双下划线 `__` 开头（private）
- 【推荐】避免单字符名称（除了计数器和迭代器）
- 【推荐】避免包/模块名中使用连字符(-)
- 【推荐】避免双下划线开头和结尾的名称（Python保留）

## 编程规范

### 函数和方法
- 【推荐】函数应该有明确的返回值，没有返回时显式返回 `None`
- 【必须】避免使用可变类型作为默认参数
- 【必须】优先使用 `def` 定义函数而不是 `lambda`
- 【必须】模块内部禁止定义重复函数声明
- 【推荐】复杂的条件判断应该拆分为多行或提取为函数

### 异常处理
- 【必须】异常类继承自 `Exception` 而不是 `BaseException`
- 【必须】使用 `raise ValueError('message')` 而不是 `raise ValueError, 'message'`
- 【必须】捕获具体异常而不是使用裸露的 `except:`
- 【推荐】重新抛出异常时使用 `raise` 而不是 `raise ex`
- 【推荐】`try` 块中的代码应该尽可能少
- 【推荐】未知的条件分支应该抛出异常而不是返回 `None`

### 条件判断
- 【必须】使用 `is not` 而不是 `not ... is`
- 【必须】不要与 `True`/`False` 进行比较
- 【必须】对于序列判断，使用 `if seq:` 而不是 `if len(seq):`
- 【必须】使用三目运算符：`x = a if condition else b`
- 【可选】`if` 与 `else` 尽量一起出现，而不是全部都是`if`子句

### 操作符换行
- 【推荐】对于二元操作符，操作符允许在换行符之后出现（PEP8推荐做法，更具备可读性）
- 注意：pycodestyle 工具与此条目相反，需要屏蔽 pycodestyle 的 W503 警告

### 括号和元组
- 【必须】tuple 元组不允许逗号结尾，显式增加括号规避
- 【必须】即使一个元素的元组也要加上括号：`return (1,)`
- 【必须】避免意外创建元组：`return 1,` 应写成 `return (1,)`

### 列表推导式
- 【必须】仅用于简单场景，复杂逻辑使用传统 for 循环
- 【必须】禁止超过1个for语句或过滤器表达式（注意：这里的"或"是指任何一个条件超过1个都不允许）
- 【推荐】列表推导式适用于简单场景，如果语句过长，每个部分应该单独置于一行
- 【推荐】不要在列表推导式中调用有副作用的函数

### 文件和资源管理
- 【必须】使用 `with` 语句管理文件和资源
- 【必须】显式关闭文件和 socket 连接
- 【推荐】对于不支持 `with` 语句的对象，使用 `contextlib.closing()`

### 访问控制
- 【推荐】对于简单的访问操作，直接使用公有变量而不是 getter/setter
- 【推荐】当需要复杂逻辑处理时，使用 `get_foo()` 和 `set_foo()` 方法
- 【推荐】可以使用 property 装饰器来保持语法一致性

### 变量使用
- 【必须】禁止定义了变量却不使用它
- 【推荐】使用双下划线 `__` 来代表不需要的变量，避免与 `gettext()` 函数冲突

## 文档和注释

### 注释规范
- 【必须】所有 `#` 注释与代码同级，置于代码之上
- 【必须】注释以 `# ` 开头（# 后跟一个空格）
- 【必须】行内注释与代码至少间隔 2 个空格
- 【必须】TODO 注释格式：`# TODO(name): description`
- 同样可以使用 `# FIXME(name): description` 和 `# NOTES(name): description`
- 【推荐】对于复杂操作可以在代码前写多行注释说明

### 文档字符串
- 【推荐】公共模块、函数、类、方法必须包含文档字符串
- 【必须】使用三重双引号 `"""`
- 【必须】第一行为简短描述，空一行后添加详细描述
- 【推荐】推荐使用 reStructuredText 格式
- 【推荐】包含参数、返回值、异常的说明

### 类型提示
- 【必须】在新项目中使用类型提示
- 【必须】冒号后有一个空格，冒号前无空格
- 【必须】等号两边各有一个空格
- 【推荐】循环引用时使用 `if typing.TYPE_CHECKING` 和字符串形式的类型注解

## 文件结构规范

### 文件头部
```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
```

### 文件编码和换行
- 【必须】源文件编码统一使用 UTF-8，需要在文件头部添加编码声明
- 【必须】避免不同操作系统换行差异，一律使用 LF 换行符
- 【必须】非程序入口的文件不应该出现 Shebang

### 模块结构顺序
1. Shebang 行（如需要）
2. 编码声明
3. 版权信息
4. 模块文档字符串
5. `__future__` 导入
6. 模块级别的 dunder 变量（`__all__`, `__version__` 等）
7. 标准库导入
8. 第三方库导入
9. 本地导入
10. 模块级别的常量和变量
11. 类和函数定义

### Main 函数
- 【必须】所有文件都应该可被导入
- 【必须】使用 `if __name__ == '__main__':` 保护主程序入口

## 工具配置建议

### 推荐使用的工具
- **flake8**：代码风格检查
  - 忽略 W503（二元操作符前换行）
  - 忽略 E203（冒号前空格）
- **pylint**：代码质量检查
  - 使用行内注释禁用特定检查：`# pylint: disable=broad-except`
  - 多行禁用：`# pylint: disable=invalid-name` / `# pylint: enable=invalid-name`
- **black**：代码格式化
  - 使用 `# fmt: off` / `# fmt: on` 临时关闭格式化
- **mypy**：类型检查
- **isort**：导入排序

### EditorConfig 配置
```ini
[*.py]
indent_style = space
indent_size = 4
max_line_length = 120
trim_trailing_whitespace = true
insert_final_newline = true
charset = utf-8
end_of_line = lf
```

## 性能和最佳实践

### 性能优化
- 【推荐】避免在循环中进行重复计算
- 【推荐】使用生成器表达式处理大数据集
- 【推荐】合理使用缓存和内存管理
- 【推荐】选择合适的数据结构

## 代码审查要点
- 【推荐】代码逻辑是否清晰易懂
- 【推荐】异常处理是否完善
- 【推荐】是否有潜在的性能问题
- 【推荐】文档和注释是否充分
- 【推荐】测试覆盖是否足够
- 【推荐】是否遵循编码规范

## 禁止的做法
- 【必须】使用裸露的 `except:`
- 【必须】在函数参数中使用可变默认值
- 【必须】使用 `from module import *`
- 【必须】定义但不使用的变量
- 【必须】行尾空白字符
- 【必须】不一致的缩进
- 【必须】过长的行（超过 120 字符）
- 【必须】重复的函数定义
- 【必须】使用 `lambda` 表达式赋值给变量
- 【必须】在同一行写多个语句（除简单的 if 语句）
- 【必须】使用 `+` 或 `+=` 在循环中拼接字符串
- 【必须】使用过时的异常抛出方式：`raise ValueError, 'message'`

## 特殊情况处理
- 【推荐】使用 `__` 代表不需要的变量，避免与 `gettext()` 函数冲突
- 【推荐】对于经常变动的参数列表，建议每行一个元素并添加尾部逗号
- 【可选】使用 `# noqa` 注释临时屏蔽 flake8 检查
- 【可选】避免在代码中使用三重引号，除非是文档字符串
- 【可选】简单的 if 语句可以与测试语句放在同一行（无 else 时）
- 【必须】绝不要将 `try`/`except` 放在同一行
- 【必须】每个语句应该独占一行
- 【必须】赋值符号左右至少有一个空格

记住：代码是写给人看的，机器只是顺便执行而已。保持代码简洁、可读、可维护。