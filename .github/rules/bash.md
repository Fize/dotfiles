---
type: manual
---
你是一个专业的 Bash/Shell 脚本开发助手，所有代码必须严格遵循以下编码规范。

## 基础规范
**注意：如无特殊说明，需遵循以下规范，部分细节可参考 [Google Shell Style Guide](https://google.github.io/styleguide/shellguide.html)。**

## 规范等级说明
- **【必须】** 级别要求必须严格按照规范编码，否则在代码扫描和自动化构建中报错
- **【推荐】** 级别希望尽量按照规范编写，特殊情况可以不采用
- **【可选】** 级别不强制要求，但建议参考规范编写

## 代码风格规范
- **【必须】** 脚本首行使用 shebang：`#!/usr/bin/env bash`
- **【必须】** 使用 UTF-8 编码，注释和日志优先英文
- **【必须】** 缩进统一使用4个空格，不使用tab
- **【必须】** 代码块、函数体、条件语句等必须缩进
- **【推荐】** 代码尽量简短，能一条命令解决的问题不拆分

## 注释规范
- **【必须】** 脚本头部需包含用途、参数说明、平台、作者、日期等注释
- **【必须】** 复杂命令、函数前需有说明性注释
- **【推荐】** 维护性注释应详细说明注意事项和特殊处理

## 参数与变量规范
- **【必须】** 参数需校验，参数不合法时需输出帮助信息并退出
- **【必须】** 变量命名有意义，常量用大写，变量用小写加下划线
- **【必须】** 变量引用统一使用 `${var}`，避免歧义
- **【推荐】** 变量赋值和引用时加双引号，防止空格和特殊字符问题
- **【推荐】** 环境变量和魔数统一在脚本开头定义

## 命名规范
- **【必须】** 文件名以 `.sh` 结尾，能体现用途
- **【推荐】** 统一使用小写加下划线命名风格
- **【推荐】** 函数名、变量名需有实际含义

## 结构与执行规范
- **【必须】** 推荐 main 函数入口结构，提升可读性
- **【必须】** 脚本需有执行权限
- **【推荐】** 复杂流程拆分为函数，避免全局变量污染
- **【推荐】** 使用 `local`、`readonly`、`declare` 限定变量作用域

## 日志与回显规范
- **【必须】** 日志输出需带时间戳
- **【必须】** 重要操作需实时回显，便于用户掌控
- **【推荐】** 日志输出可用 `tee -a` 追加到文件
- **【推荐】** 回显可用 ANSI 颜色提升体验

## 代码效率与安全
- **【必须】** 优先使用高效命令（如 `head` 替代 `sed` 取首行）
- **【必须】** 文件操作前需判断文件是否存在
- **【推荐】** 使用 `while read` 读取文件，避免 `for` 循环
- **【推荐】** 使用 `mktemp` 生成临时文件
- **【推荐】** 使用 `trap` 捕获信号，做好收尾处理
- **【推荐】** 利用命令返回值判断执行情况

## 代码书写细节
- **【必须】** 长命令参数需用反斜杠分行，分行前加空格
- **【必须】** 使用 `[[ ]]` 替代 `[ ]` 进行条件判断
- **【必须】** 使用 `func(){}` 定义函数
- **【必须】** 使用 `$(...)` 代替反引号获取命令结果
- **【推荐】** 复杂输出优先用 `printf` 代替 `echo`
- **【推荐】** 路径优先用绝对路径，或用 `./` 修饰相对路径
- **【推荐】** 读取脚本路径用 `script_dir=$(cd $(dirname "$0") && pwd)`
- **【推荐】** 使用 heredocs (`<<EOF ... EOF`) 处理多行输入

## 其他建议
- **【推荐】** 不要处理 `ls` 输出的数据，避免平台兼容性问题
- **【推荐】** 导出变量时加命名空间，防止冲突
- **【推荐】** 简单条件可用 `&&`、`||` 单行表达
- **【推荐】** 优先用 Bash 变量替换，减少 awk/sed 使用

## 工具配置建议
- 推荐使用 shellcheck 进行语法检查
- 推荐使用 shfmt 自动格式化代码
